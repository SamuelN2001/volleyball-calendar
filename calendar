<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Volleyball Clinics Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f5f5f5;
    }
    header {
      background-color: #800000;
      padding: 20px;
      text-align: center;
      color: white;
      font-size: 1.8em;
    }
    #calendar {
      max-width: 1000px;
      margin: 40px auto;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .fc-event {
      border-radius: 8px;
      padding: 4px;
      font-size: 0.85em;
      cursor: pointer;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    .btn {
      background-color: #800000;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }
    .btn:hover {
      background-color: #a00000;
    }
    #confirmation {
      display: none;
      background-color: #d4edda;
      padding: 15px;
      margin-top: 10px;
      border-radius: 8px;
      color: #155724;
    }
  </style>
</head>
<body>

<header>üèê Volleyball Clinics Calendar</header>

<div id="calendar"></div>

<!-- Modal -->
<div id="eventModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2 id="modalTitle"></h2>
    <p id="modalTime"></p>
    <p id="modalDesc"></p>
    <form id="registerForm">
      <input type="text" id="name" placeholder="Your Name" required><br><br>
      <input type="email" id="email" placeholder="Your Email" required><br><br>
      <input type="text" id="position" placeholder="Position" required><br><br>
      <button type="submit" class="btn">Register</button>
    </form>
    <div id="confirmation">
      ‚úÖ You are registered!
      <br><br>
      <button id="addToCalendarBtn" class="btn">Add to Calendar</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const calendarEl = document.getElementById('calendar');

  const events = [
    { title: 'Setter Clinic', start: '2025-08-18T09:00:00', end: '2025-08-18T10:30:00', description: 'Improve your setting skills', color: '#007bff' },
    { title: 'Hitter Clinic', start: '2025-08-18T11:00:00', end: '2025-08-18T12:30:00', description: 'Attacking drills and timing', color: '#28a745' },
    { title: 'Libero Clinic', start: '2025-08-19T09:00:00', end: '2025-08-19T10:30:00', description: 'Defensive skills & passing', color: '#ffc107' },
    { title: 'Middle Blocker Clinic', start: '2025-08-19T11:00:00', end: '2025-08-19T12:30:00', description: 'Blocking & quick attacks', color: '#dc3545' },
    { title: 'Serve & Serve Receive', start: '2025-08-20T09:00:00', end: '2025-08-20T10:30:00', description: 'Serving techniques', color: '#6f42c1' }
  ];

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'timeGridWeek',
    events: events,
    eventClick: function (info) {
      document.getElementById('modalTitle').innerText = info.event.title;
      document.getElementById('modalTime').innerText =
        info.event.start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) +
        ' - ' +
        info.event.end.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      document.getElementById('modalDesc').innerText = info.event.extendedProps.description;

      document.getElementById('registerForm').dataset.session = info.event.title;
      document.getElementById('registerForm').dataset.startTime = info.event.start.toISOString();
      document.getElementById('registerForm').dataset.endTime = info.event.end.toISOString();

      document.getElementById('eventModal').style.display = 'block';
    }
  });

  calendar.render();

  document.getElementById('closeModal').onclick = function () {
    document.getElementById('eventModal').style.display = 'none';
  };

  // Form submission
  document.getElementById('registerForm').onsubmit = function (e) {
    e.preventDefault();
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const position = document.getElementById('position').value;
    const session = e.target.dataset.session;
    const startTime = e.target.dataset.startTime;
    const endTime = e.target.dataset.endTime;

    fetch("https://script.google.com/macros/s/AKfycbzz8t2urxwX3z45UWDtMaHVUHfT5dOfdhzjox1dpc8WQkJC0n_qcIZ69GqDinwbvIuS/exec", {
      method: "POST",
      mode: "no-cors", // avoid CORS errors locally
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ name, email, position, session, startTime, endTime })
    })
    .then(() => {
      document.getElementById('registerForm').style.display = 'none';
      document.getElementById('confirmation').style.display = 'block';
    })
    .catch(err => {
      alert("Registration failed: " + err.message);
    });

    // Add to Calendar button
    document.getElementById('addToCalendarBtn').onclick = function () {
      const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${session}
DTSTART:${startTime.replace(/[-:]/g, '').split('.')[0] + 'Z'}
DTEND:${endTime.replace(/[-:]/g, '').split('.')[0] + 'Z'}
END:VEVENT
END:VCALENDAR`;

      const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${session}.ics`;
      link.click();
    };
  };
});
</script>
</body>
</html>
